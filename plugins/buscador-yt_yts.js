import ytSearch from "yt-search"
const handler = async (m, { conn, usedPrefix, args, command }) => {
try {
const text = args.length >= 1 ? args.slice(0).join(" ") : (m.quoted && m.quoted?.text || m.quoted?.caption || m.quoted?.description) || null
    
if (!text) return conn.reply(m.chat, `${lenguajeGB['smsAvisoMG']()}ğ™€ğ™ğ˜¾ğ™ğ™„ğ˜½ğ˜¼ ğ™€ğ™‡ ğ™‰ğ™Šğ™ˆğ˜½ğ™ğ™€ ğ˜¿ğ™€ ğ™ğ™‰ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š ğ™Š ğ˜¾ğ˜¼ğ™‰ğ˜¼ğ™‡ ğ˜¿ğ™€ ğ™”ğ™Šğ™ğ™ğ™ğ˜½ğ™€\n\nğ™’ğ™ğ™„ğ™ğ™€ ğ™ğ™ƒğ™€ ğ™‰ğ˜¼ğ™ˆğ™€ ğ™Šğ™ ğ˜¼ ğ™”ğ™Šğ™ğ™ğ™ğ˜½ğ™€ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š ğ™Šğ™ ğ˜¾ğ™ƒğ˜¼ğ™‰ğ™‰ğ™€ğ™‡`, fkontak, m)
    
const { all: [bestItem, ...moreItems] } = await ytSearch(text)
const videoItems = moreItems.filter(item => item.type === 'video')
const formattedData = {
title: `${htki} ğ™ğ™€ğ™ğ™ğ™‡ğ™ğ˜¼ğ˜¿ğ™Šğ™ ${htka}\n\n`,
rows: [{
title: `${htki} *ğ™ğ™€ğ™ğ™ğ™‡ğ™ğ˜¼ğ˜¿ğ™Šğ™* ${htka}`,
highlight_label: "Popular",
rows: [{
header: bestItem.title,
id: `${usedPrefix}yta ${bestItem.url}`,
title: bestItem.description,
description: ""
}]
}, {
title: `${htki} *ğ™ˆğ˜¼ğ™ ğ™ğ™€ğ™ğ™ğ™‡ğ™ğ˜¼ğ˜¿ğ™Šğ™* ${htka}`,
rows: videoItems.map(({
title,
url,
description
}, index) => ({
header: `à¦“ ${index + 1}) ${title}`, 
id: `.yta ${url}`,
title: description,
description: ""
}))
}]
}
const emojiMap = {
type: "ğŸ¥",
videoId: "ğŸ†”",
url: "ğŸ”—",
title: "ğŸ“º",
description: "ğŸ“",
image: "ğŸ–¼ï¸",
thumbnail: "ğŸ–¼ï¸",
seconds: "â±ï¸",
timestamp: "â°",
ago: "âŒš",
views: "ğŸ‘€",
author: "ğŸ‘¤"
}
    
const caption = Object.entries(bestItem).map(([key, value]) => {
const formattedKey = key.charAt(0).toUpperCase() + key.slice(1)
const valueToDisplay = key === 'views' ? new Intl.NumberFormat('en', { notation: 'compact' }).format(value) : key === 'author' ? `Nombre: ${value.name || 'Desconocido'}\nà¦“ URL :\nÂ» ${value.url || 'Desconocido'}` : value || 'Desconocido';
return ` ${emojiMap[key] || 'ğŸ”¹'} *${formattedKey}:* ${valueToDisplay}`}).join('\n')

await conn.sendButtonMessages(m.chat, [
[formattedData.title + caption, wm, bestItem.image || bestItem.thumbnail || logo, [
["âš¡ ğ™‘ğ™¤ğ™¡ğ™«ğ™šğ™§ ğ™–ğ™¡ ğ™ˆğ™šğ™£ğ™ªÌ | ğ˜½ğ™–ğ™˜ğ™  ğ™©ğ™¤ ğ™ˆğ™šğ™£ğ™ª", usedPrefix + 'menu']
], null, [
['ğŸ’š ğ˜¾ğ™–ğ™£ğ™–ğ™¡ ğ™Šğ™›ğ™ğ™˜ğ™ğ™–ğ™¡ | ğ™Šğ™›ğ™›ğ™ğ™˜ğ™ğ™–ğ™¡ ğ™˜ğ™ğ™–ğ™£ğ™£ğ™šğ™¡', canal2]
],
[["ğŸ” ğ˜½ğ™ªğ™¨ğ™˜ğ™–ğ™§ | ğ™ğ™šğ™–ğ™§ğ™˜ğ™", formattedData.rows]]
]], m)

} catch (error) {
console.error(error)
conn.reply(m.chat, `OcurriÃ³ un error.`, m)
}
}

handler.command = /^y(outubesearch|ts(earch)?)$/i
export default handler

/*import yts from 'yt-search';
let handler = async (m, { conn, usedPrefix, text, args, command }) => {
if (!text) conn.reply(m.chat, `${lenguajeGB['smsAvisoMG']()}ğ™€ğ™ğ˜¾ğ™ğ™„ğ˜½ğ˜¼ ğ™€ğ™‡ ğ™‰ğ™Šğ™ˆğ˜½ğ™ğ™€ ğ˜¿ğ™€ ğ™ğ™‰ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š ğ™Š ğ˜¾ğ˜¼ğ™‰ğ˜¼ğ™‡ ğ˜¿ğ™€ ğ™”ğ™Šğ™ğ™ğ™ğ˜½ğ™€\n\nğ™’ğ™ğ™„ğ™ğ™€ ğ™ğ™ƒğ™€ ğ™‰ğ˜¼ğ™ˆğ™€ ğ™Šğ™ ğ˜¼ ğ™”ğ™Šğ™ğ™ğ™ğ˜½ğ™€ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š ğ™Šğ™ ğ˜¾ğ™ƒğ˜¼ğ™‰ğ™‰ğ™€ğ™‡`, fkontak,  m)
try {
    let result = await yts(text);
    let ytres = result.videos;
  let teskd = `ğ˜½ğ™ªğ™¨ğ™¦ğ™ªğ™šğ™™ğ™– ğ™™ğ™š *${text}*`
    
let listSections = [];
for (let index in ytres) {
        let v = ytres[index];
        listSections.push({
         title: `${htki} ğ™ğ™€ğ™ğ™ğ™‡ğ™ğ˜¼ğ˜¿ğ™Šğ™ ${htka}`,
            rows: [
                {
                    header: 'ğ—” ğ—¨ ğ—— ğ—œ ğ—¢',
                    title: "",
                    description: `${v.title} | ${v.timestamp}\n`, 
                    id: `${usedPrefix}ytmp3 ${v.url}`
                },
                {
                    header: "ğ—© ğ—œ ğ—— ğ—˜ ğ—¢",
                    title: "" ,
                    description: `${v.title} | ${v.timestamp}\n`, 
                    id: `${usedPrefix}ytmp4 ${v.url}`
                }, 
              {
                    header: "ğ—” ğ—¨ ğ—— ğ—œ ğ—¢   ğ—— ğ—¢ ğ—–",
                    title: "" ,
                    description: `${v.title} | ${v.timestamp}\n`, 
                    id: `${usedPrefix}play3 ${v.url}`
                }, 
                {
                    header: "ğ—© ğ—œ ğ—— ğ—˜ ğ—¢   ğ—— ğ—¢ ğ—–",
                    title: "" ,
                    description: `${v.title} | ${v.timestamp}\n`, 
                    id: `${usedPrefix}play4 ${v.url}`
                }
            ]
        });
    }
await conn.sendList(m.chat, `${htki} *ğ™ğ™€ğ™ğ™ğ™‡ğ™ğ˜¼ğ˜¿ğ™Šğ™* ${htka}\n`, `\nğ˜½ğ™ªğ™¨ğ™¦ğ™ªğ™šğ™™ğ™– ğ™™ğ™š: ${text}`, `ğ—• ğ—¨ ğ—¦ ğ—– ğ—” ğ—¥`, listSections, fkontak);
} catch (e) {
await conn.sendButton(m.chat, `\n${wm}`, lenguajeGB['smsMalError3']() + '#report ' + usedPrefix + command, null, [[lenguajeGB.smsMensError1(), `#reporte ${lenguajeGB['smsMensError2']()} *${usedPrefix + command}*`]], null, null, m)
console.log(e) 
}}
handler.help = ['playlist']
handler.tags = ['dl']
handler.command = /^playlist|ytbuscar|yts(earch)?$/i
handler.limit = 1
handler.level = 3
export default handler*/
