import fetch from 'node-fetch'
import { facebookDl } from './scraper.js'
import { savefrom, facebookdl, facebookdlv2 } from '@bochilteam/scraper'
import fbDownloader from 'fb-downloader-scrapper'
let handler = async (m, { conn, args, command, usedPrefix }) => {
let user = global.db.data.users[m.sender]
let fkontak = { "key": { "participants":"0@s.whatsapp.net", "remoteJid": "status@broadcast", "fromMe": false, "id": "Halo" }, "message": { "contactMessage": { "vcard": `BEGIN:VCARD\nVERSION:3.0\nN:Sy;Bot;;;\nFN:y\nitem1.TEL;waid=${m.sender.split('@')[0]}:${m.sender.split('@')[0]}\nitem1.X-ABLabel:Ponsel\nEND:VCARD` }}, "participant": "0@s.whatsapp.net" }
if (!args[0]) return conn.reply(m.chat, `${lenguajeGB['smsAvisoMG']()}ğ™„ğ™‰ğ™‚ğ™ğ™€ğ™ğ™€ ğ™ğ™‰ ğ™€ğ™‰ğ™‡ğ˜¼ğ˜¾ğ™€ ğ˜¿ğ™€ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† ğ™‹ğ˜¼ğ™ğ˜¼ ğ˜¿ğ™€ğ™ğ˜¾ğ˜¼ğ™ğ™‚ğ˜¼ğ™ ğ™€ğ™‡ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š\nğ™€ğ™…ğ™€ğ™ˆğ™‹ğ™‡ğ™Š\n*${usedPrefix + command} https://www.facebook.com/watch?v=636541475139*\n\nğ™€ğ™‰ğ™ğ™€ğ™ ğ˜¼ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† ğ™‡ğ™„ğ™‰ğ™† ğ™ğ™Š ğ˜¿ğ™Šğ™’ğ™‰ğ™‡ğ™Šğ˜¼ğ˜¿ ğ™ğ™ƒğ™€ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š\nğ™€ğ™“ğ˜¼ğ™ˆğ™‹ğ™‡ğ™€\n*${usedPrefix + command} https://fb.watch/dcXq_0CaHi/*`, fkontak, m)
if (!args[0].match(/www.facebook.com|fb.watch/g)) return conn.reply(m.chat, `${lenguajeGB['smsAvisoMG']()}ğ™„ğ™‰ğ™‚ğ™ğ™€ğ™ğ™€ ğ™ğ™‰ ğ™€ğ™‰ğ™‡ğ˜¼ğ˜¾ğ™€ ğ˜¿ğ™€ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† ğ™‹ğ˜¼ğ™ğ˜¼ ğ˜¿ğ™€ğ™ğ˜¾ğ˜¼ğ™ğ™‚ğ˜¼ğ™ ğ™€ğ™‡ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š\nğ™€ğ™…ğ™€ğ™ˆğ™‹ğ™‡ğ™Š\n*${usedPrefix + command} https://www.facebook.com/watch?v=636541475139*\n\nğ™€ğ™‰ğ™ğ™€ğ™ ğ˜¼ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† ğ™‡ğ™„ğ™‰ğ™† ğ™ğ™Š ğ˜¿ğ™Šğ™’ğ™‰ğ™‡ğ™Šğ˜¼ğ˜¿ ğ™ğ™ƒğ™€ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š\nğ™€ğ™“ğ˜¼ğ™ˆğ™‹ğ™‡ğ™€\n*${usedPrefix + command} https://fb.watch/dcXq_0CaHi/*`, fkontak, m)
const sections = [
{
title: htjava + ' ğŸ“¡ ğ™‡ğ™„ğ™ğ™ğ˜¼ ğ˜¿ğ™€ ğ˜¿ğ™€ğ™ğ˜¾ğ˜¼ğ™ğ™‚ğ˜¼ğ™ ' + htjava,
rows: [
{title: "ğŸ“¡ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† (ğ™¤ğ™¥ğ™˜ğ™ğ™¤ğ™£ 1) ", rowId: `${usedPrefix}fb1 ${args[0]}`},
{title: "ğŸ“¡ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† (ğ™¤ğ™¥ğ™˜ğ™ğ™¤ğ™£ 2) ", rowId: `${usedPrefix}fb2 ${args[0]}`},
//{title: "ğŸ“¡ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† (ğ™¤ğ™¥ğ™˜ğ™ğ™¤ğ™£ 3) ", rowId: `${usedPrefix}fb3 ${args[0]}`},
//{title: "ğŸ“¡ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† (ğ™¤ğ™¥ğ™˜ğ™ğ™¤ğ™£ 4) ", rowId: `${usedPrefix}fb4 ${args[0]}`},
//{title: "ğŸ“¡ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† (ğ™¤ğ™¥ğ™˜ğ™ğ™¤ğ™£ 5) ", rowId: `${usedPrefix}fb5 ${args[0]}`}
]}]	
const listMessage = {
text: `ğ™ğ™€ğ™‡ğ™€ğ˜¾ğ˜¾ğ™„ğ™Šğ™‰ğ™€ ğ™ğ™‰ğ˜¼ ğ™Šğ™‹ğ˜¾ğ™„ğ™Šğ™‰ ğ™‹ğ˜¼ğ™ğ˜¼ ğ˜¿ğ™€ğ™ğ˜¾ğ˜¼ğ™ğ™‚ğ˜¼ğ™\n\nğ™ğ™€ğ™‡ğ™€ğ˜¾ğ™ ğ˜¼ğ™‰ ğ™Šğ™‹ğ™ğ™„ğ™Šğ™‰ ğ™ğ™Š ğ˜¿ğ™Šğ™’ğ™‰ğ™‡ğ™Šğ˜¼ğ˜¿`,
footer: `*ğ—£ğ—¥ğ—˜ğ— ğ—œğ—¨ğ—  ${user.premium ? "âœ…": "âŒ"}*\n${wm}`,
title: `*â”â”€â”€â”€ê•¤ ğŸ“¡ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™† ê•¤â”€â”€â”€â”*`,
buttonText: `ğŸ›°ï¸ ğ™€ğ™¡ğ™šğ™œğ™ğ™§ ğ˜¿ğ™šğ™¨ğ™˜ğ™–ğ™§ğ™œğ™– ğŸ›°ï¸`,
sections }  
try {
let contenido = `âœ… ğ™‘ğ™„ğ˜¿ğ™€ğ™Š ğ˜¿ğ™€ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™†\n${wm}`
switch (command) { 
case "facebook": case "fb": case "facebookdl": case "fbdl":                
await conn.sendMessage(m.chat, listMessage, {quoted: fkontak} )
break      
case "facebook1": case "fb1": case "facebookdl1": case "fbdl1": 
let vio = await fetch(`https://api.violetics.pw/api/downloader/facebook?apikey=beta&url=${args[0]}`)  
let vioo = await vio.json()
let videovio = `${vioo.result.hd.url || vioo.result.sd.url}`
await conn.reply(m.chat, `${lenguajeGB['smsAvisoEG']()}ğ™€ğ™ğ™‹ğ™€ğ™ğ™€ ğ™ğ™‰ ğ™ˆğ™Šğ™ˆğ™€ğ™‰ğ™ğ™Š, ğ™ğ™€ ğ™€ğ™ğ™ğ˜¼ ğ˜¿ğ™€ğ™ğ˜¾ğ˜¼ğ™ğ™‚ğ˜¼ğ™‰ğ˜¿ğ™Š ğ™ğ™ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š ğ˜¿ğ™€ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™†\n\nğ™’ğ˜¼ğ™„ğ™ ğ˜¼ ğ™ˆğ™Šğ™ˆğ™€ğ™‰ğ™, ğ™”ğ™Šğ™ğ™ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š ğ™„ğ™ ğ˜¿ğ™Šğ™’ğ™‰ğ™‡ğ™Šğ˜¼ğ˜¿ğ™„ğ™‰ğ™‚`, fkontak, m)
await conn.sendFile(m.chat, videovio, `error.mp4`, contenido, m)
break
//let res = await fbDownloader(args[0])
//for (let result of res.download) {
//let ur = result.url
//await conn.sendMessage(m.chat, { video: { ur }, caption: contenido }, { quoted: m })}


case "facebook2": case "fb2": case "facebookdl2": case "fbdl2":   
await conn.reply(m.chat, `${lenguajeGB['smsAvisoEG']()}ğ™€ğ™ğ™‹ğ™€ğ™ğ™€ ğ™ğ™‰ ğ™ˆğ™Šğ™ˆğ™€ğ™‰ğ™ğ™Š, ğ™ğ™€ ğ™€ğ™ğ™ğ˜¼ ğ˜¿ğ™€ğ™ğ˜¾ğ˜¼ğ™ğ™‚ğ˜¼ğ™‰ğ˜¿ğ™Š ğ™ğ™ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š ğ˜¿ğ™€ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™†\n\nğ™’ğ˜¼ğ™„ğ™ ğ˜¼ ğ™ˆğ™Šğ™ˆğ™€ğ™‰ğ™, ğ™”ğ™Šğ™ğ™ ğ™‘ğ™„ğ˜¿ğ™€ğ™Š ğ™„ğ™ ğ˜¿ğ™Šğ™’ğ™‰ğ™‡ğ™Šğ˜¼ğ˜¿ğ™„ğ™‰ğ™‚`, fkontak, m)
const { result } = await facebookdl(args[0]).catch(async _ => await facebookdlv2(args[0]))
for (const { url, isVideo } of result.reverse()) await conn.sendMessage(m.chat, { video: { url }, fileName: `error.mp4`, mimetype: 'video/mp4' , caption: contenido }, { quoted: m })   
break
//let ress = await facebookDl(args[0]).catch(async _ => await savefrom(args[0])).catch(_ => null)
//let urll = ress?.url?.[0]?.url || ress?.url?.[1]?.url || ress?.['720p'] || ress?.['360p']
//await conn.sendMessage(m.chat, { video: { urll }, caption: contenido }, { quoted: m })  

}} catch {
await m.reply(`${lenguajeGB['smsAvisoFG']()}ğ˜¼ğ™‡ğ™‚ğ™Š ğ™ğ˜¼ğ™‡ğ™„ğ™Š ğ™ˆğ˜¼ğ™‡, ğ™ğ™€ğ˜¾ğ™ğ™€ğ™ğ˜¿ğ™€ ğ™ğ™ğ˜¼ğ™ ğ™ğ™‰ ğ™€ğ™‰ğ™‡ğ˜¼ğ˜¾ğ™€ ğ™‘ğ˜¼ğ™‡ğ™„ğ˜¿ğ™Š ğ˜¿ğ™€ ğ™ğ˜¼ğ˜¾ğ™€ğ˜½ğ™Šğ™Šğ™†`)
}}
handler.command = /^(facebook|fb|facebookdl|fbdl|facebook1|fb1|facebookdl1|fbdl1|facebook2|fb2|facebookdl2|fbdl2)$/i
handler.limit = 3
export default handler
